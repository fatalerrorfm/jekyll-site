Soroush Khanlou
Chris, I've got something to tell you about the world we live in. It is the dumbest possible.

Chris Dzombak
That's true. Did you see Kodak has a cryptocurrency.

Soroush Khanlou
Now, and they're selling you, like, a.

Chris Dzombak
Bitcoin miner, and there's a contract, and.

Soroush Khanlou
You got to pay them whatever Bitcoins you come up with.

Chris Dzombak
Yeah, like half of the coins.

Soroush Khanlou
Not good.

Chris Dzombak
I don't understand. This is so weird. Just yeah, it is.

Soroush Khanlou
And their stock price went up.

Chris Dzombak
Yeah, it went up, like 40% or something. Right? Because I don't know, this is the world we live in. Okay, I'm switching over to my quiet mouse. Here the podcasting mouse.

Soroush Khanlou
Podcasting mouse.

Chris Dzombak
All right, well, it's a mouse that doesn't make a clicky noise. So see, here's the old mouse.

Soroush Khanlou
Clicking.

Chris Dzombak
Clicking. Yeah. Okay. Here's this one.

Soroush Khanlou
I can't actually still hear that one, for what it's worth.

Chris Dzombak
Well, I was holding it, like, two inches from microphone.

Soroush Khanlou
Okay. Yeah, it is soft.

Chris Dzombak
Yeah, you can probably still hear it, like, scraping around on the desk. But what are you going to do?

Soroush Khanlou
I have some crypto now.

Chris Dzombak
So what do you have?

Soroush Khanlou
I just bought some bitcoin. Yeah, exactly. So I bought not a lot, like $400 worth just to be like, let's just see what happens. And I probably lost a ton of value in it. And it was down to the coinbase app will show you how much total value you have. And I had low 300 for a little while, so I lost quite a bit.

Chris Dzombak
Yeah, you want to buy high, sell low strategy that I'm going with here.

Soroush Khanlou
Now, it's at 347, so I'm still a little bit short. But it was in the positive. It was above 400 a couple of days ago for a little bit.

Chris Dzombak
So I do have some questions here. So first of all, how did you buy Bitcoin?

Soroush Khanlou
So you just get the coinbase app, you hook up your bank account or a credit card or a debit card, and then you can kind of just do it.

Chris Dzombak
Okay. And then, see, the thing is with Bitcoin now is I'm not really convinced that it's going to go higher than where it is now.

Soroush Khanlou
Yeah, somebody told me an exorbitantly high number that it's going to go to, but then I was like, that's exactly what you would say if you had a bunch of Bitcoin and you wanted it to go to that high.

Chris Dzombak
Right.

Soroush Khanlou
A, because you're deluding yourself, and B, because you want to dilute me.

Chris Dzombak
I've been kicking myself. I remember back in 2009, like an undergrad in college, and I was reading some article about this new Bitcoin thing. It's this new digital currency based on this cryptography stuff. And I remember just thinking, this seems weird. I'm not going to do anything with this. This isn't worth getting into. But if I had just installed a little piece of software and mined a little bit of Bitcoin, then I would have bought a house now.

Soroush Khanlou
Yeah, totally. I equally beat myself up about it, hindsight's 2020. But, like, I think the thing you got to remember is, like, okay, so remember when Bitcoin hit 1000, like, two or three years ago?

Chris Dzombak
Oh, yeah. So what really would have happened? You would have sold when it hit, and then I'd be kicking myself now.

Soroush Khanlou
You can't just have kind of done a little bit of a coin on the side. You have to really be a true believer to actually commit to.

Chris Dzombak
Yeah, well, I mean, if I had just, like, mined a little bit on the side for a few months back when it first came out and then sold it even when it hit $1,000.

Soroush Khanlou
I think there wouldn't have been nothing.

Chris Dzombak
Yeah, no, it wouldn't have been bad.

Soroush Khanlou
Yeah. I regret it, too.

Chris Dzombak
So one of my coworkers has realized that back when Dogecoin came out, he mined just, like, several thousand, like, maybe 9000 dogecoins or something like that.

Soroush Khanlou
Wow.

Chris Dzombak
Or yeah, something like that. Maybe it was even more. But anyway, Dogecoin is now worth 1.5 cents, so he's now going back being like, whoa, wait, I have $90. I guess I forget exactly how the numbers work in worked out because he's, like, $1,000 in Dogecoin now.

Soroush Khanlou
This headline says, dogecoin Market Cap Hits 1 billion to its creators dismay. That's pretty funny.

Chris Dzombak
I kind of wish that I knew more about how to get into this in such a way that I stand some chance of actually coming out ahead, but I don't.

Soroush Khanlou
Yeah, me too. That's basically how I feel. I think we are who we are, and that's why we didn't get into Bitcoin at the time and why we would have sold early if we had.

Chris Dzombak
Yeah. I remember looking at this and reading some article on probably ours technica and thinking, this seems really weird and kind of stupid.

Soroush Khanlou
Yeah, I had the exact same feeling about it. And it's so frustrating because we're the exact kind of people that would have messed with this stuff.

Chris Dzombak
Right. I should be rich right now.

Soroush Khanlou
We had free power. I think we are cynical to some degree, but we do believe on some level that technology has the power to impact the world in a good way.

Chris Dzombak
Definitely is the power to impact the world.

Soroush Khanlou
Well, I mean, what we're in this industry, I hope that we think that it has the power to impact the world.

Chris Dzombak
Yeah, no, that's absolutely true. I do believe that you can't pass up the opportunity to be a little snarky that's right. When Kodak is selling you a $4,000 bitcoin miner, that you have to give them. Okay. Yeah. In terms of programming topics, I mean, maybe just as a little bit of background information here, we'll put a bunch of reading in the show notes. But these problems I'm trying to pick the right word because I guess vulnerability would be the right word as well.

Soroush Khanlou
They are bugs.

Chris Dzombak
Bugs are these problems that are common to basically all modern processors that use all the best optimizations that we know how to do to make processors run quickly and execute your code as quickly as possible.

Soroush Khanlou
Right.

Chris Dzombak
Turn out to enable some really clever attacks that let attackers do things like or that in theory at least, let attackers do things like read out kernel memory or read physical memory arbitrarily. Even if you're running in JavaScript in a browser or something, or read memory from another process that's running on the same machine, which could be like one password, which could be one password, which could be, if you're thinking in a server context, could be like private key for your SSL certificate company. Yeah, right.

Soroush Khanlou
I want to add on the JavaScript note that's the most horrifying part yes, the most horrifying part, at least on some level. I can control what apps I run. There's no way for me to control what JavaScript runs on my computer.

Chris Dzombak
Yeah. So I will, first of all, throw in a pitch here. If you're not running an ad blocker, I mean, you should be. There are two ways about that at this point.

Soroush Khanlou
Like in 2018, that seems right to me too. I've actually experimented with browsing with no JavaScript enabled at all. And there's a lot of things that are broken, but the things that are not broken are way better.

Chris Dzombak
Yeah, believe that.

Soroush Khanlou
Try browsing even like Amazon with JavaScript turned on, and then turn off JavaScript and it's blazing fast. If you click on something and it's just instantly loaded, it's unreal how much better of an experience it is.

Chris Dzombak
Yeah, I would totally believe that.

Soroush Khanlou
It's really quite curious.

Chris Dzombak
The other thing to note, right, is that the JavaScript angle here is not theoretical. The authors of the paper on the spectre, one of these vulnerabilities have a proof of concept that is written in JavaScript and can dump memory from the Google Chrome application that's running their JavaScript, which is terrifying. There's no other word for that.

Soroush Khanlou
Yeah, really bad. Yeah. I don't think there is any way to really do anything other than I've been kind of thinking about going to no Script Life. There's another plugin like Ad Block called no Script, which I think fewer people know about, but enables you to, I think, pick on a per website basis if it gets to run JavaScript or not. So something like Google Web Page maybe doesn't actually need to run JavaScript. Yeah, google Maps probably does.

Chris Dzombak
Yeah, absolutely. So that's one thing, the standard advice here that really applies for users. Like, if you don't want to run no Script, definitely run an ad blocker and install software updates when they come out. Right. The meltdown vulnerability has been pretty much mitigated by software updates for OS ten dating back even to LCAP. So that's what, two major OS releases ago now.

Soroush Khanlou
Oh, is that right?

Chris Dzombak
Yeah. They have updates for LCAP, for Sierra and for High Sierra. So you don't have to upgrade all the way to High Sierra. There are also fixes in these updates for Safari that help to mitigate the threat of the spectre vulnerability from JavaScript running in Safari.

Soroush Khanlou
That's good. And my understanding, and nobody's really been able to fully explain this to me, but that the patches will be continuing because there's different, slightly different vectors that you can take. Yeah, it's not just patch at once and it's fixed it's like continuously.

Chris Dzombak
Right. So I can try to take a stab at this here. Kind of the conceptually simpler one of these problems, the one that was mainly a problem for intel, although there is at least one Arm processor that's vulnerable to it, is the quote unquote Meltdown vulnerability. And this is one where it basically exploits almost like a race condition in how the processor orders instructions that it's executing for performance and when permissions actually get checked in memory accesses. So there exists a little bit of race condition there. And that's what Meltdown is exploiting in order to read arbitrary memory from the kernel or from physical memory, because physical memory is mapped, or at least was mapped into the kernel's address space. This is the one that is mitigated via updates in how the kernel works at the operating system level. So this one is pretty well solved at this point, with a fairly small performance penalty, depending on your workload. The other one of these, and the one that you're going to see updates trickling out probably for the next several years, realistically is Spectre. And that's because the Specter attack here really describes more of a strategy for coming up with specific attacks or maybe describes an entire new class of attacks. So if you want to attack a certain application like, let's say, Google Chrome, you need to find somewhere in the Google Chrome binary or in the libraries that Google Chrome uses. Basically things that are in Google Chrome's, like address space while it's running, that you need to find some instructions that operate on data that you're interested in reading. So, like, find instructions that operate somehow or do something based on, say, the passwords that you've stored in Google Chrome, assuming those are in memory. Right, right.

Soroush Khanlou
It's like a branch. This is the branch prediction thing.

Chris Dzombak
We'll get there. We'll get there. You need to find instructions that operate on that and that do something like read it or take a branch based on it, or do something that causes some side effect that you can observe. So in this case, the side effects that are easiest to exploit right now are, like, if you can get Google chrome to run some instructions that do something based on the content of, say, a password in memory, and then the processor switches back to your JavaScript and you can observe, based on timing, how quickly some memory accesses are. You can take advantage of whatever those instructions in Google Chrome did to the cache to start to reconstruct. What's in Google Chrome's memory? The way that you do that, the last piece of this is that you have to get Google Chrome to execute just those instructions that you were interested in. And you can do that by reverse engineering how the processor's branch predictor works. So the processor has some silicon on it that's dedicated to keeping a table of what it thinks branch instructions are likely to do, and it learns from what software is doing. If you reverse engineer exactly how this thing learns, you can train it that this branch that I found somewhere in the JavaScript interpreter, you can make the processor think that it's going to branch off to these useful instructions that you found that operate on passwords somehow. And even if that's not what the branch would actually do, the processor will sort of speculatively go down that path until maybe possibly several hundred cycles later, it figures out that that's not the path that was supposed to go down. But at that point, even though the processor basically undoes the execution of those instructions, the side effect that those instructions did affect the processor's cache in some way that you can observe makes it so that you can still use those instructions that you found that operate on passwords, even though Google Chrome never intended to execute those, and even though the processor rolled back its execution of those instructions. That was a long description, but it's kind of because this is definitely a really clever and pretty complicated attack. But did that make any sense?

Soroush Khanlou
It made some sense. So many questions.

Chris Dzombak
All right, let's hear them.

Soroush Khanlou
So basically you're saying that based on the timing of how long these executions take to these speculative executions, the ones in the branch that it should never have taken get executed, that your JavaScript program can observe that timing what's the side effect is. The side effect like writing to a disk. Somebody on a podcast said semaphore, which I know what a semaphore is in what we do, but I didn't know they were also in processor programming.

Chris Dzombak
Yeah. So there are a couple of different side effects looking at the cache, one, since that's the one that has been most well studied so far. So a classic example here is let's say that let's simplify this and say you're not running JavaScript in Google Chrome. You're maybe just calling some simple function via some inner process like function call mechanism. Right. So you might pass this function of value, and the function might check that that number is in range of an array. And then if it is, do something or load some other memory based on reading out of that array. Something that you could do here is pass a number to this function that's out of bounds of that first array, and that'll have the effect of, like.

Soroush Khanlou
Let'S assume that that is unchecked, right. It'll get something outside of the bounds of the array so far. I'm with you.

Chris Dzombak
Right, so it would get something out of the bounds of the array and then load something else from memory based on whatever that out of bounds read was.

Soroush Khanlou
Right.

Chris Dzombak
And that is the thing that will pull something into the processor's cache because that's a load from memory. Right. And then there are various ways that you can tell what part of the cache got disrupted by that memory load. You can use that because you can predict what memory addresses get cached where in the cache. It's not like just a dictionary that you can store arbitrary things in. It's keyed based on memory addresses. There are tax that let you tell what memory address got accessed based on which of the things that you expect to be in the cache take a lot longer to access. Meaning that the processor is loading that from main memory now, meaning that something evicted like that address from the cache.

Soroush Khanlou
Right. But you still can't read what's at that address.

Chris Dzombak
Right. But remember how this cache side effect happened in this theoretical example differently based on what was in that first array that we went out of what we read that was out of bounds from that first array. So let's say that we read interesting. Yeah. So let's say that we read out of bounds in this first array, the number two, and then the code goes and says, okay, so I read my number from my array and I'm going to multiply it by four and then use that as to dereference some other array and then loads that. Then the memory address that you're loading depends through this chain on the contents of that first bit of memory that was just outside the range of the first array, right?

Soroush Khanlou
Right? Yes. That I got.

Chris Dzombak
And so then you can run a timing attack and see what memory address got loaded into the cache based on that load.

Soroush Khanlou
Weird. So you kind of have to know what kind of cache algorithm the processor is using so that you know what it's going to evict from what it's going to replace in the cache.

Chris Dzombak
Yeah, but then you can work backward. You can say, okay, I know that this memory address got loaded into the cache and so working backward, I know that that memory address would have been caused by this value being used, being read from this out of bounds from array one.

Soroush Khanlou
Interesting. That's real weird.

Chris Dzombak
It's really weird. And the way that the branch prediction, speculative execution plays into this is getting you to read out of bounds in array one in the first place because.

Soroush Khanlou
That should trap.

Chris Dzombak
Right, and it won't.

Soroush Khanlou
Until a bunch more things have processed, right? Because it'll just keep barreling through and not actually checking like, hey, was this out of bounds?

Chris Dzombak
Well, and it will check it's just.

Soroush Khanlou
That it happens later and then rolls those instructions that it shouldn't have executed back.

Chris Dzombak
Yeah, and so it rolls all that back, but it doesn't roll back the change that happened in the cache.

Soroush Khanlou
In the cache.

Chris Dzombak
And so you can figure out what memory address got loaded in the cache and work backward. Like in the example I gave, I think divide by four or whatever.

Soroush Khanlou
You.

Chris Dzombak
Need to know about the code that you're attacking, obviously in quite a lot of detail. But you can work backward and figure out what was in this address in the victim processes memory space that you shouldn't be able to read at all. So maybe doing a podcast about this was a mistake because this is so hard to describe. I really recommend, actually, that you read the Google Project Zero blog post that will throw in the show notes and if you're interested, like, PDF the academic paper about this attack. It really is clever.

Soroush Khanlou
And I couldn't make it through the academic paper and I couldn't make it through even the Google blog post. It was like, immediately over my head. This is why I've got you.

Chris Dzombak
Yeah. I feel like I'm doing a poor job of explaining this.

Soroush Khanlou
No, you're doing a better job than normal. Because the other stuff I've heard is like, everybody's trying to do so with some metaphor and they're like, imagine I was listening to The Verge cast and they were like, imagine there's a bank robber and the bank robber is in another universe, and the bank robber robs the bank. And in the bank there's Neil I. Patel's. Netflix password is there. And then the bank robber gets shot, but before getting shot, whispers it to you across the universe, and then you get the password without ever having entered the bank. And it's like, I see what you're trying to say, but that is not a good analysis.

Chris Dzombak
Imagine there's something like a bounce check that you can get around, if only temporarily, by reverse engineering how a specific processor model works. And then after that bounds check, the program reads something from an array, does some computation on that value, and loads something from memory based on that computation. If you can tell just the address of the memory that was loaded, you can undo that computation and look at and figure out what value was in that array or what value was out of bounds of that array. Because remember, you managed to skip that bounds check, if only temporarily.

Soroush Khanlou
Right.

Chris Dzombak
I guess that's the 32nd.

Soroush Khanlou
Yeah, no, that's making some sense. And part of me is like, the fact that it's so complicated, does that mean I don't have to worry about it?

Chris Dzombak
So that's a really good question.

Soroush Khanlou
This seems like a really complex attack because, as you say, you need to know something about how the victim program operates. You need to know how the processor architecture on the user's system operates. You need to know all these different things, and then it sounds like you need to run for a very long time to piece together exactly all these little components that also might be changing. Right?

Chris Dzombak
Right.

Soroush Khanlou
The Ram and the different caches are always changing.

Chris Dzombak
Right. So you may not need to run for a really long time. I think the number that the paper gave was that they could read from another process's memory at something like 15, which is slow, but is not nothing.

Soroush Khanlou
Jesus Christ.

Chris Dzombak
So whether you need to worry, the answer is like, it depends, basically, right? Browsers are rolling out mitigations that help harden the browsers and specifically the JavaScript interpreters against this sort of attack. Obviously, it takes a significant amount of effort and knowledge about your target to run this attack. I mean, on the other hand, the people who put together this paper have a proof of concept that can read Google Chrome memory from JavaScript, which is clearly something to worry about. But it really depends is the answer. If you're running like a web server on some shared infrastructure, then you're going to want to make sure that you install software updates and this kind of thing. If you're just like running your home laptop, this isn't really something to worry about aside from the usual, like, install software updates advice, right?

Soroush Khanlou
So, yeah, my parents asked me about it. They're like, what should I do? I was like, Install your software update.

Chris Dzombak
Yeah, that's that's that's all you can do? That's really it. If you're in charge of valuable companies like SSL termination, then you should worry a little bit more and think more in depth about your defenses. Right?

Soroush Khanlou
I kind of think that especially if you're a bigger client of some of these cloud providers, they're going to start offering plans that let you run all of your servers on the same physical machines and maybe you pay a little bit more, but you don't have other people's processes running on your machines. You get exclusive.

Chris Dzombak
Yeah, I could totally see that. I kind of thought that Amazon offered something like that, but I could be completely wrong. I'm really not sure. The exciting thing, just to go back to this spectre attack, which I've been trying to describe now for like 20 minutes, the exciting thing here is that the thing that I've described isn't the only possible attack. If you can find some instructions in the victim that you're attacking that cause any side effect that you can observe, it doesn't have to be necessarily a side effect in the cache. People who do this research have looked into other side effects that the processor doesn't roll back after it speculates or incorrectly predicts a branch. And so there are other possible side effects to look at. It doesn't have to be like bounds check and an array access and computation and another memory access. There are other possible other possible variants here that make it really hard to defend against this in general, both at a software and at a hardware level. And so this is going to be something that especially like compiler sort of level people are going to be thinking about for a very, very long time. And something that people who design processors are going to be thinking about for a long, long time. And people who write operating systems are going to be thinking about for a long, long time.

Soroush Khanlou
Yeah.

Chris Dzombak
It's exciting though, from a security research kind of perspective. It is like reading this we were all like reading these papers this weekend, right? And texting each other and slacking each other. Did you see? This is so clever. It is exciting. It's kind of terrifying, but it's exciting.

Soroush Khanlou
Yeah. The scope is definitely very big. The scale is big. But if the scope is kind of as big as people are afraid it is, it's definitely terrifying.

Chris Dzombak
Yeah.

Soroush Khanlou
I know what you mean though. I kind of want to be in an earthquake. I've never really been in a big earthquake. I was close enough to the one in 2011 in Virginia to feel it, but I was kind of jealous of the San Francisco people. I want to feel an earthquake, but also earthquakes cause a lot of damage and they're really horrible.

Chris Dzombak
Yeah. And I mean, this is something that like, I don't know, it's it's probably not something to really worry about today. People will obviously put a lot of effort now into reverse engineering how processor branch predictors work and how their caches work to make it easier to run these kind of attacks. People are going to put a lot of effort into software to help look for useful gadgets that create useful side effects. People are going to do even more research than they have been doing for the last several years on these microarchitectural side channels that can be used to get information, to communicate information from one process to another. Things like cache timing, attacks. And there are several other possibilities. It's interesting stuff.

Soroush Khanlou
As an application developer, what do I need to do? Do I need to worry about this on any level? Is there any way that I could write my code that will make it less susceptible to this?

Chris Dzombak
Yes. So it's a little bit early to say. There are LLVM and GCC patches that implement one possible that implement one technique that makes this harder to harder to exploit, at least on most processors. We'll throw links to those in the Show Notes as well as a Google document that describes this Mitigation technique. So you could build your software with that. In these slightly longer term, processor vendors are probably going to add something that allows the operating system to tell them to disable branch prediction temporarily or to clear out the branch predictor.

Soroush Khanlou
For sensitive areas of code.

Chris Dzombak
Right.

Soroush Khanlou
You can reset the branch predictor. That's an interesting idea.

Chris Dzombak
Exactly. Yeah. So that, for example, if you're switching into or if the kernel starts running some sensitive like a crypto algorithm, but any of these mitigations that can be done in software or without actual new processor hardware are still only kind of a partial fix.

Soroush Khanlou
Right? One thing I want to throw out, you keep talking about timing attacks and I think one thing that's worth talking about is like what a timing attack is. And I think that this is one of those things that is actually also useful for application developers to know. So one cool one that I know about is if you use, let's say, an equality check on two strings, usually that'll be short circuited. So it'll check the first character or the first byte or whatever it's doing, it'll check that if it's not equal, it'll just immediately stop. Or if the first five characters between the two strings are equal, but the six characters off on that six character, it will stop. So a very, very clever attacker who has access to timing information can basically give it a password to check. And if it short circuits, then it knows that that password didn't have the right first character. So it can try a bunch of first characters. And if it gets the right first character, then it moves on to the second one and it sees that that equality check took a little bit longer. And so it knows now that that first character is correct and it keeps doing that until it has basically generated the whole password. It's a really cool, clever thing. And this is why you're not really supposed to you're supposed to use a special class of functions when you're doing crypto stuff. So like when you use Bcrypt or something like that, that handles all that stuff for you, which is very nice. And this is why they say stuff like don't implement crypto yourself because you're going to screw it up.

Chris Dzombak
Yeah, that's the classic example of how timing can leak information in sensitive code like that. And obviously this is really important in crypto code. The example of guessing a password character by character, by just looking at, by guessing the first character and seeing which first character just takes seeing which first characters take less time to check is something that's really easy to explain. There are all sorts of really clever timing attacks against all sorts of different cryptography implementations. And people who implement crypto code spend a whole lot of time making sure that not just the code is written in a way that we would call constant time. Meaning that it takes the same amount of time regardless of the inputs, but that the code that's output, like that the assembly, that's output is constant time. And the compiler didn't do anything clever to try to optimize it in certain cases.

Soroush Khanlou
Right, that's another big one, is you got to know what your compiler is generating on the far. Side and make sure that that's not optimized either.

Chris Dzombak
Yeah. And so the way that this plays out in something like in something like these processor cache timing attacks is, like I mentioned, we can work backward just by knowing what memory addresses the victim code that we were trying to attack access.

Soroush Khanlou
Right, right.

Chris Dzombak
And so what I can do is, before I call whatever function I'm going to call in the victim process, I can make sure that the CPU's cache is filled with addresses, with my addresses. So I'll fill it with address two, three, four, and five. Right? Yeah. And then I'll run the victim code, and then I can try to access those addresses again once the victim code runs. And time. Okay. How long does it take for me to access address two? How long does it take to access address three and four and five and one?

Soroush Khanlou
The idea being that one of those things may have gotten evicted to from the L One cache to the L Two cache, so then it would take longer. And so you know that something important is in that block of memory.

Chris Dzombak
Right. And so let's say it takes me longer to access address three than the other ones. I know that the victim process used something at address three in its virtual address space. And so then I know that that address is three, and I can work backward and figure out what the data that the program used to derive that address three was gotcha. And that's how you take the, like, this timing attack and transform it back into yeah. That byte that that I read, that was out of bounds, but I was able to trick the processor into reading for it for 100 cycles.

Soroush Khanlou
Interesting.

Chris Dzombak
Yeah.

Soroush Khanlou
And it actually occurs to me also that I was saying maybe because this is so complex, we don't need to worry about it. But when hashing algorithms are broken right. So when MD Five was broken, the first known forced collision that they made was really convoluted. But as they got better and better at it, it became more and more trivial to generate these collisions. And so just because it's really hard now doesn't mean that it's not going to be simpler or commodified later.

Chris Dzombak
Absolutely. Yeah. Attacks only get better with time. Defenses get better with time, too. So it's kind of cat and mouse, but this isn't going to stay really hard to do for years, maybe even for months.

Soroush Khanlou
Yeah. No, this is a real concern. Do you think intel knew about it before it was reported by the Google people? Like the concept of somebody could attack our stuff like this.

Chris Dzombak
So an important thing to call.

Soroush Khanlou
Bear in mind, this is a patreon episode, so we could be very honest.

Chris Dzombak
Yeah, totally. I'd be honest. Regardless, it's important to call out here. That what we've been talking about for most of this episode is the Specter attack, which affects not just intel, but intel processors, AMD processors, most newer and more advanced Arm processors, because they all have branch predictors, and none of them clear the branch predictors when you change threads, because that would be a really serious performance. I rely really heavily, actually, on these branch predictors to get good performance out of modern processors. So just doing the trivially obvious thing and clearing the branch predictor when you change threads would be a really noticeable.

Soroush Khanlou
Performance hit, or when you change processes, I guess that would have the same problem.

Chris Dzombak
Yeah. And so what was your question? Did intel and everyone know about this? Probably not. I don't think that anyone, like, knew, oh, hey, this branch predictor can be exploited in this way to leak this information into the cache. I think what happened here is that we have all these different performance optimizations that we've layered on over the past couple of decades, right. The way that processor caches work, the way that branch predictors work, the way that we can speculatively execute, like, 200 instructions and then roll that back if it turns out that we guessed this branch incorrectly.

Soroush Khanlou
The way we parallelize different instructions and do them at the same time or out of order, even. Even if the code was written in order.

Chris Dzombak
Yeah. These are all interacting now in ways that nobody really foresaw. Right. And that's I mean, it's a hard thing to foresee, it's a hard thing to predict, even if it seems obvious in retrospect. But no, I don't think that anyone knew that this was possible and decided that it wasn't a problem that they needed to fix in their processors. From the perspective of someone designing a processor, you can say, yeah, we may access something out of bounds and do some operations on it if we guess this branch wrong. But that gets rolled back before we commit any of those results, like, before the software that's running sees any of those results. So it doesn't matter if we guess this branch incorrectly, and usually we guess correctly, but it turns out that there are these side effects that people have spent many years trying to figure out how to see and how to use to smuggle data across these boundaries.

Soroush Khanlou
And it turns out that that it's all very cyberpunk.

Chris Dzombak
Yeah.

Soroush Khanlou
Smuggling data across boundaries.

Chris Dzombak
Yeah. Well, that's that's what it is.

Soroush Khanlou
Friend of the show, Zach Dreyer, sent me this page that I'll put in the show notes, which is a little bit where I learned about how you're not supposed to compare secret strings, like one byte at a time with short circuiting. So I put in the show notes, and actually, some of these are really interesting. I kind of have read them before, but the code is in C, so it's, like, hard for me to understand.

Chris Dzombak
Yeah, that's fair.

Soroush Khanlou
The very first one is first thing you should do, compare secret strings in constant time. We talked about that one. To avoid branchings controlled by secret data. We can also imagine how the branch predictor would basically be affected by that. The third one interestingly is avoid table lookups indexed by secret data. The access time of a table element can vary with this index, depending, for example, on whether a cache miss has occurred. This has been exploited in a series of cache timing attacks on AES. So it's not an unknown strategy?

Chris Dzombak
No, timing attacks generally are not an unknown strategy.

Soroush Khanlou
Right. They're unknown to people like me who don't have to write, like, very sure critical code. Yeah.

Chris Dzombak
The new thing here is the idea of finding and exploiting basically just random sets of instructions somewhere in a different processes, address space to cause these side effects that you can then run a timing attack on. So it's like exploiting these processor features in order to be able to use one of these timing attacks, which we've known about for quite a long time.

Soroush Khanlou
Yeah. Pretty crazy, man.

Chris Dzombak
It really is. Like I said, it's really interesting stuff.

Soroush Khanlou
Well, it is interesting and it's like it doesn't leave a trace either when people do it to you. So very scary stuff in terms of computer security.

Chris Dzombak
Yeah. On the other hand, security problems get found all the time and there are definitely things that you can do even right now to help make your code, to help make your binaries less vulnerable to this like we talked about. And processor designers and operating system maintainers will implement more and more, like more and better fixes for this that let you make whatever performance security trade off you want and it's going to be okay. It's scary, but things will probably more or less be okay.

Soroush Khanlou
Yeah.

Chris Dzombak
It is really cool though.

Soroush Khanlou
Yeah.

Chris Dzombak
I hope I did an okay job explaining this. I think especially the first round of explanations was a little bit rough.

Soroush Khanlou
No, it was good. This stuff is complicated and I think having a conversation about it and helping one technical person, helping another technical person understand it can be useful because hopefully I have some of the same questions that some of our listeners will have and hopefully, hopefully you'll answer them, which I think we did an okay job of. I don't know. It's a very wild bug.

Chris Dzombak
It really is. Yeah. I'll note especially this is a Patreon episode. Like, if something's unclear. You have more questions about this, please send us questions on patreon. Twitter email. I love talking about this stuff.

Soroush Khanlou
Yeah, we got an email from a listener and I responded back a little bit and Chris responded back like a lot. So if you want to know more, chris will write you a long ass email. This absolutely will happen.

Chris Dzombak
It may take me a couple of days to find time to write a long email, but I will do it.

Soroush Khanlou
He can't help himself. He has to write the long email. So if you have more questions, hit us up. Because also, if you ask questions, there's also patreon comments if you want everybody to see them. Yeah, for sure. Cool. Should we sign off?

Chris Dzombak
It's been a long episode. I think we should sign off. Of course there's a patreon episode. Thank you all so much for your support. We've said many times before, you are making this podcast possible. We couldn't pay our editor and pay our sort of hosting costs without your support. And so thank you for that.

Soroush Khanlou
Yeah, absolutely. Your support makes this podcast possible.

Chris Dzombak
And on that note, always good to talk to you, Sirush. I'll talk to you later. Bye.

